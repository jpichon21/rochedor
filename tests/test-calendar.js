const Nightmare = require('nightmare')
const addContext = require('mochawesome/addContext')
const sinon = require('sinon')
const request = require('request')
const chai = require('chai')
const should = chai.should()

const imgDir = './tests/reports/screenshots/inscription'

describe('Load Page', function () {
  this.timeout('30s')
  let nightmare = null
  beforeEach(() => {
    nightmare = new Nightmare()
  })
  describe('L\'inscription doit se dÃ©rouler sans erreur', () => {
    it('Les actions suivantes doivent se derouler sans timout', done => {
      addContext(this, `./screenshots/inscription/Initial-Page.png`)
      done()
      // nightmare
      //   .goto('http://127.0.0.1:8001/inscription-retraite')
      // // .screenshot(`${imgDir}button-yes-no.png`)
      //   .wait('.item.connection .button.yes')
      //   .click('.item.connection .button.yes')
      //   .wait('.panel.connection')
      // // .screenshot(`${imgDir}login-form.png`)
      //   .type('.panel.connection .input.id', 'Admin')
      //   .type('.panel.connection .input.password', 'Admin')
      //   .click('.panel.connection .button.submit')
      //   .wait('.panel.participants.active')
      //   .screenshot(`${imgDir}recap-participants.png`)
      //   .click('.panel.participants.active .add-participant')
      //   .wait('.modify-render.active')
      //   .screenshot(`${imgDir}form-participants.png`)
      //   .select('.modify-render.active .relation', 'enfants')
      //   .select('.modify-render.active .organizer', 'admin')
      //   .select('.modify-render.active .gender', 'Mme')
      //   .type('.modify-render.active .surname', 'Helene')
      //   .type('.modify-render.active .name', 'Admin')
      //   .type('.modify-render.active .adress', '8 rue des passants')
      //   .type('.modify-render.active .zipcode', '25000')
      //   .select('.modify-render.active .country', 'france')
      //   .type('.modify-render.active .phone', '03814578')
      //   .type('.modify-render.active .mobile', '06174856')
      //   .type('.modify-render.active .email', 'Helene-Admin@gmail.com')
      //   .type('.modify-render.active .birthday', '24/09/1995')
      //   .type('.modify-render.active .profession', 'Etudiante')
      //   .click('.modify-render.active .button.submit')
      //   .wait('.registered-render')
      //   .screenshot(`${imgDir}recap-feed-participants.png`)
      //   .click('.registered-render .add-to-activity')
      //   .click('.panel.participants.active .validate.participants')
      //   .wait('.item.validation.active')
      //   .wait('.item.validation.active .validate')
      //   .end()
      //   .then(function (result) { done() })
      //   .catch(done)
    })
    describe('L\'email est envoyer', () => {
      it('Il s\'agit du bonne email', (done) => {
        request('http://127.0.0.1:8080/api/emails', function (err, res, body) {
          res.statusCode.should.eql(200)
          res.headers['content-type'].should.contain('application/json')
          body = JSON.parse(body)
          body[0].subject.should.eql('kezajfmoi')
          body[0].headers.from.should.eql('Tristan Cuenot <webmaster@logomotion.fr>')
          done()
        })
      })
    })
  })
})
